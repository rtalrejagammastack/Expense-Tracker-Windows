<%= render partial: 'shared/heading', locals: { heading: "New Expense Category For #{ @user_category.name } Category" } %>

<%= form_with model: [ @user_category, @user_category.expense_categories.build ], remote: :true do |form| %>
  <% if @expense.errors.any? %>
    <div id="error_explanation">
      <h2><%= pluralize(@expense.errors.count, "error") %> prohibited this expense from being saved:</h2>
      <ul>
        <% @expense.errors.full_messages.each do |message| %>
          <li><%= message %></li>
        <% end %>
      </ul>
    </div>
  <% end %>
  <div class="row">
    <div class="col-md-4 mb-4">
      <div class="form-outline">
        <%= form.text_field :name, autofocus: true, class:"form-control form-control-lg" %>
        <%= form.label :name, class:"form-label" %>
      </div>
    </div>
  </div>
  <%= form.submit class:"btn btn-success btn-rounded shadow btn-lg" %>
<% end %>


<script>
  $(document).on('submit', '#new_expense', function(e) {
    e.preventDefault();
    const formData = $(this).serialize();
    const url = $(this).attr('action');
    $.ajax({
      type: 'POST',
      url: url,
      data: formData,
      success: function(response) {
        $('#new_expense')[0].reset();
        App.notifications.send('A new expense has been added.');
      }
    });
  });

  // Mark all notifications as read
  $(document).on('click', '#mark-all-as-read-button', function() {
    $.ajax({
      type: 'PUT',
      url: '/notifications/mark_all_as_read',
      success: function(response) {
        $('#notifications-list li').addClass('read');
      }
    });
  });

  // Initialize Action Cable
  App.notifications = App.cable.subscriptions.create('NotificationsChannel', {
    received: function(data) {
      $('#notifications-list').prepend(data.notification);
    }
  });
</script>